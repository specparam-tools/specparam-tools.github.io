<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>10: Tuning &amp; Troubleshooting &#8212; specparam 2.0.0rc4 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=284a2d1d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/my-styles.css?v=ba41382c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b1cabfd8"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=a56c686a"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172157729-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172157729-1');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          specparam</a>
        <span class="navbar-text navbar-version pull-left"><b>2.0.0rc4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../api.html">API</a></li>
                <li><a href="../faq.html">FAQ</a></li>
                <li><a href="../glossary.html">Glossary</a></li>
                <li><a href="../auto_motivations/index.html">Motivations</a></li>
                <li><a href="index.html">Tutorials</a></li>
                <li><a href="../auto_examples/index.html">Examples</a></li>
                <li><a href="../visualizers.html">Visualizers</a></li>
                <li><a href="../reference.html">Reference</a></li>
                <li><a href="https://github.com/fooof-tools/fooof">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-tutorials-plot-10-troubleshooting-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="tuning-troubleshooting">
<span id="sphx-glr-auto-tutorials-plot-10-troubleshooting-py"></span><h1>10: Tuning &amp; Troubleshooting<a class="headerlink" href="#tuning-troubleshooting" title="Permalink to this heading">¶</a></h1>
<p>Tips &amp; tricks for choosing algorithm settings, tuning fits, and troubleshooting.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># General imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Import the model objects</span>
<span class="kn">from</span> <span class="nn">specparam</span> <span class="kn">import</span> <a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class"><span class="n">SpectralModel</span></a><span class="p">,</span> <a href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel" title="specparam.SpectralGroupModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class"><span class="n">SpectralGroupModel</span></a>

<span class="c1"># Import some utilities for creating simulated power-spectra</span>
<span class="kn">from</span> <span class="nn">specparam.sim</span> <span class="kn">import</span> <a href="../generated/specparam.sim.sim_power_spectrum.html#specparam.sim.sim_power_spectrum" title="specparam.sim.sim_power_spectrum" class="sphx-glr-backref-module-specparam-sim sphx-glr-backref-type-py-function"><span class="n">sim_power_spectrum</span></a><span class="p">,</span> <a href="../generated/specparam.sim.sim_group_power_spectra.html#specparam.sim.sim_group_power_spectra" title="specparam.sim.sim_group_power_spectra" class="sphx-glr-backref-module-specparam-sim sphx-glr-backref-type-py-function"><span class="n">sim_group_power_spectra</span></a>
<span class="kn">from</span> <span class="nn">specparam.sim.params</span> <span class="kn">import</span> <a href="../generated/specparam.sim.params.param_sampler.html#specparam.sim.params.param_sampler" title="specparam.sim.params.param_sampler" class="sphx-glr-backref-module-specparam-sim-params sphx-glr-backref-type-py-function"><span class="n">param_sampler</span></a>
<span class="kn">from</span> <span class="nn">specparam.sim.utils</span> <span class="kn">import</span> <a href="../generated/specparam.sim.utils.set_random_seed.html#specparam.sim.utils.set_random_seed" title="specparam.sim.utils.set_random_seed" class="sphx-glr-backref-module-specparam-sim-utils sphx-glr-backref-type-py-function"><span class="n">set_random_seed</span></a>
</pre></div>
</div>
<section id="algorithm-settings">
<h2>Algorithm Settings<a class="headerlink" href="#algorithm-settings" title="Permalink to this heading">¶</a></h2>
<p>With default settings, the power spectrum model is relatively minimally constrained. It
defaults as such since there are not universal settings that work across all different
recording modalities. Appropriate settings also vary with power spectrum quality (noise,
or effectively, the smoothness of the power spectrum), and frequency ranges.</p>
<p>For any given dataset, you will likely have to tune some of the algorithm settings
for optimal performance.</p>
<p>To do so, we suggest using a combination of the following considerations:</p>
<ul class="simple">
<li><p>A priori constraints, given your data, such as the number of peaks you expect to extract</p></li>
<li><p>Qualitative analysis, guided by examining the the plotted model fit results,
as compared to input data</p></li>
<li><p>Quantitative analysis, considering the model goodness of fit metrics
(however, see note at the bottom regarding interpreting these metrics)</p></li>
</ul>
<p>Choosing settings to tune model fitting is an imperfect art, and should be done carefully,
as assumptions built into the settings chosen will impact the model results. Model
fitting is generally not overly sensitive to small changes in the settings, so as long
as broadly appropriate settings are chosen, small perturbations to these chosen settings
should not have a large impact on the fitting.</p>
<p>We do recommend that model settings should not be changed between power spectra
(across channels, trials, or subjects), if they are to be meaningfully compared.
We therefore recommend first testing fitting the model across some representative
spectra, in order to select settings, which you then keep constant for the full analysis.</p>
</section>
<section id="tuning-the-algorithm">
<h2>Tuning the Algorithm<a class="headerlink" href="#tuning-the-algorithm" title="Permalink to this heading">¶</a></h2>
<p>With default settings, the model fit is fairly liberal at fitting peaks, and so
most commonly this will lead to overfitting, being overzealous at fitting small
noisy bumps as peaks.</p>
<p>In some cases, you may also find you need to relax some settings, to get better fits.</p>
<p>You also need to make sure you pick an appropriate aperiodic fitting procedure,
and that your data meets the assumptions of the approach you choose (see the tutorial
on aperiodic fitting).</p>
<p>The remainder of this notebook goes through some examples of choosing settings
for different datasets.</p>
</section>
<section id="reducing-overfitting">
<h2>Reducing Overfitting<a class="headerlink" href="#reducing-overfitting" title="Permalink to this heading">¶</a></h2>
<p>If the model appears to be overfitting (for example, fitting too many peaks to small bumps), try:</p>
<ul class="simple">
<li><p>Setting a lower-bound bandwidth-limit, to exclude fitting very narrow peaks, that may be noise</p></li>
<li><p>Setting a maximum number of peaks that the algorithm may fit: <cite>max_n_peaks</cite></p>
<ul>
<li><p>If set, the algorithm will fit (up to) the <cite>max_n_peaks</cite> highest power peaks.</p></li>
</ul>
</li>
<li><p>Setting a minimum absolute peak height: <cite>min_peak_height</cite></p></li>
</ul>
</section>
<section id="simulating-power-spectra">
<h2>Simulating Power Spectra<a class="headerlink" href="#simulating-power-spectra" title="Permalink to this heading">¶</a></h2>
<p>For this example, we will use simulated data. The <cite>specparam</cite> module includes utilities
for creating simulated power-spectra. To do so, we can use the <a class="reference internal" href="../generated/specparam.sim.sim_power_spectrum.html#specparam.sim.sim_power_spectrum" title="specparam.sim.sim_power_spectrum"><code class="xref py py-func docutils literal notranslate"><span class="pre">sim_power_spectrum()</span></code></a>
function to simulate individual power spectra, following the power spectrum model.</p>
<p>First, we will start by simulating a noisy power spectrum.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the frequency range to simualate the power spectrum</span>
<span class="n">f_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
<span class="c1"># Set aperiodic component parameters, as [offset, exponent]</span>
<span class="n">ap_params</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="c1"># Gaussian peak parameters</span>
<span class="n">gauss_params</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="c1"># Set the level of noise to simulate the power spectrum with</span>
<span class="n">nlv</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Set random seed, for consistency creating simulated data</span>
<a href="../generated/specparam.sim.utils.set_random_seed.html#specparam.sim.utils.set_random_seed" title="specparam.sim.utils.set_random_seed" class="sphx-glr-backref-module-specparam-sim-utils sphx-glr-backref-type-py-function"><span class="n">set_random_seed</span></a><span class="p">(</span><span class="mi">21</span><span class="p">)</span>

<span class="c1"># Create a simulated power spectrum</span>
<span class="n">freqs</span><span class="p">,</span> <span class="n">spectrum</span> <span class="o">=</span> <a href="../generated/specparam.sim.sim_power_spectrum.html#specparam.sim.sim_power_spectrum" title="specparam.sim.sim_power_spectrum" class="sphx-glr-backref-module-specparam-sim sphx-glr-backref-type-py-function"><span class="n">sim_power_spectrum</span></a><span class="p">(</span>\
    <span class="n">f_range</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;fixed&#39;</span> <span class="p">:</span> <span class="n">ap_params</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;gaussian&#39;</span> <span class="p">:</span> <span class="n">gauss_params</span><span class="p">},</span> <span class="n">nlv</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit an (unconstrained) model, liable to overfit</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fm</span></a> <span class="o">=</span> <a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class"><span class="n">SpectralModel</span></a><span class="p">()</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel.report" title="specparam.SpectralModel.report" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fm</span><span class="o">.</span><span class="n">report</span></a><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_10-TroubleShooting_001.png" srcset="../_images/sphx_glr_plot_10-TroubleShooting_001.png" alt="plot 10 TroubleShooting" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>WARNING: Lower-bound peak width limit is &lt; or ~= the frequency resolution: 0.50 &lt;= 0.50
        Lower bounds below frequency-resolution have no effect (effective lower bound is the frequency resolution).
        Too low a limit may lead to overfitting noise as small bandwidth peaks.
        We recommend a lower bound of approximately 2x the frequency resolution.

==================================================================================================

                                       POWER SPECTRUM MODEL

                       The model was fit with the &#39;spectral fit&#39; algorithm
               Model was fit to the 1-50 Hz frequency range with 0.50 Hz resolution

                               Aperiodic Parameters (&#39;fixed&#39; mode)
                                        (offset, exponent)
                                         20.0456, 2.0236

                         Peak Parameters (&#39;gaussian&#39; mode) 7 peaks found
                                CF:   9.83, PW:   0.91, BW:   4.90
                                CF:  19.92, PW:   0.83, BW:   3.59
                                CF:  22.68, PW:   0.52, BW:   0.52
                                CF:  31.85, PW:   0.57, BW:   2.22
                                CF:  38.60, PW:   0.26, BW:   0.56
                                CF:  39.44, PW:   0.24, BW:   0.60
                                CF:  49.46, PW:   0.21, BW:   0.50

                                    Model fit quality metrics:
                                     error (mae) is 0.0710
                                  gof (rsquared) is 0.9893

==================================================================================================
</pre></div>
</div>
<p>Notice that in the above fit, we are very likely to think that the model has
been overzealous in fitting peaks, and is therefore overfitting.</p>
<p>This is also suggested by the model r-squared, which is suspiciously
high, given the amount of noise we in the simulated power spectrum.</p>
<p>To reduce this kind of overfitting, we can update the algorithm settings.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update settings to fit a more constrained model, to reduce overfitting</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fm</span></a> <span class="o">=</span> <a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class"><span class="n">SpectralModel</span></a><span class="p">(</span><span class="n">peak_width_limits</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">max_n_peaks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">min_peak_height</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel.report" title="specparam.SpectralModel.report" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fm</span><span class="o">.</span><span class="n">report</span></a><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_10-TroubleShooting_002.png" srcset="../_images/sphx_glr_plot_10-TroubleShooting_002.png" alt="plot 10 TroubleShooting" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>==================================================================================================

                                       POWER SPECTRUM MODEL

                       The model was fit with the &#39;spectral fit&#39; algorithm
               Model was fit to the 1-50 Hz frequency range with 0.50 Hz resolution

                               Aperiodic Parameters (&#39;fixed&#39; mode)
                                        (offset, exponent)
                                         20.0242, 1.9996

                         Peak Parameters (&#39;gaussian&#39; mode) 3 peaks found
                                CF:   9.82, PW:   0.91, BW:   4.87
                                CF:  20.03, PW:   0.82, BW:   3.88
                                CF:  31.85, PW:   0.57, BW:   2.22

                                    Model fit quality metrics:
                                     error (mae) is 0.0823
                                  gof (rsquared) is 0.9860

==================================================================================================
</pre></div>
</div>
<p>We can compare how the model fit, using the updated settings, compares to the
ground truth of the simulated spectrum.</p>
<p>Note that the simulation parameters are defined in terms of Gaussian parameters,
which are slightly different from the peak parameters (see the note in tutorial 02),
which is why we compare to the model gaussian parameters here.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare ground truth simulated parameters to model fit results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ground Truth </span><span class="se">\t\t</span><span class="s1"> Model Parameters&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sy</span><span class="p">,</span> <span class="n">fi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gauss_params</span><span class="p">),</span> <a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fm</span></a><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">periodic</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">sy</span><span class="p">,</span> <span class="o">*</span><span class="n">fi</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Ground Truth             Model Parameters
10.00  1.00  2.50         9.82  0.91  2.43
20.00  0.80  2.00        20.03  0.82  1.94
32.00  0.60  1.00        31.85  0.57  1.11
</pre></div>
</div>
<section id="power-spectra-with-no-peaks">
<h3>Power Spectra with No Peaks<a class="headerlink" href="#power-spectra-with-no-peaks" title="Permalink to this heading">¶</a></h3>
<p>A known case in which the model can overfit is in power spectra in which no peaks are
present. In this case, the standard deviation can be very low, and so the relative
peak height check (<code class="docutils literal notranslate"><span class="pre">min_peak_threshold</span></code>) is very liberal at keeping gaussian fits.</p>
<p>If you expect, or know, you have power spectra without peaks in your data,
we recommend using the <code class="docutils literal notranslate"><span class="pre">min_peak_height</span></code> setting. Otherwise, the model is unlikely to
appropriately fit power spectra as having no peaks, since it uses only a relative
threshold if <code class="docutils literal notranslate"><span class="pre">min_peak_height</span></code> is set to zero (which is the default value).
Setting <code class="docutils literal notranslate"><span class="pre">min_peak_height</span></code> requires checking the scale of your power spectra,
allowing you to define an absolute threshold for extracting peaks.</p>
</section>
</section>
<section id="reducing-underfitting">
<h2>Reducing Underfitting<a class="headerlink" href="#reducing-underfitting" title="Permalink to this heading">¶</a></h2>
<p>If you are finding that the model is underfitting:</p>
<ul class="simple">
<li><p>First check and perhaps loosen any restrictions from <code class="docutils literal notranslate"><span class="pre">max_n_peaks</span></code> and <code class="docutils literal notranslate"><span class="pre">min_peak_height</span></code></p></li>
<li><p>Try updating <code class="docutils literal notranslate"><span class="pre">peak_threshold</span></code> to a lower value</p></li>
<li><p>Bad fits may stem from issues with aperiodic component fitting</p>
<ul>
<li><p>Double check that you are using the appropriate aperiodic mode</p></li>
</ul>
</li>
</ul>
<p>Next we will simulate a much smoother power spectrum, and update settings accordingly.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the frequency range to simulate the power spectrum</span>
<span class="n">f_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
<span class="c1"># Define aperiodic parameters, as [offset, exponent]</span>
<span class="n">ap_params</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="c1"># Define peak parameters, each peak defined as [CF, PW, BW]</span>
<span class="n">gauss_params</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="c1"># Set the level of noise to simulate the power spectrum with</span>
<span class="n">nlv</span> <span class="o">=</span> <span class="mf">0.025</span>

<span class="c1"># Create a simulated power spectrum</span>
<span class="n">freqs</span><span class="p">,</span> <span class="n">spectrum</span> <span class="o">=</span> <a href="../generated/specparam.sim.sim_power_spectrum.html#specparam.sim.sim_power_spectrum" title="specparam.sim.sim_power_spectrum" class="sphx-glr-backref-module-specparam-sim sphx-glr-backref-type-py-function"><span class="n">sim_power_spectrum</span></a><span class="p">(</span>\
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;fixed&#39;</span> <span class="p">:</span> <span class="n">ap_params</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;gaussian&#39;</span> <span class="p">:</span> <span class="n">gauss_params</span><span class="p">},</span> <span class="n">nlv</span><span class="o">=</span><span class="n">nlv</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update settings to make sure they are sensitive to smaller peaks in smoother power spectra</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fm</span></a> <span class="o">=</span> <a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class"><span class="n">SpectralModel</span></a><span class="p">(</span><span class="n">peak_width_limits</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">max_n_peaks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">min_peak_height</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel.report" title="specparam.SpectralModel.report" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fm</span><span class="o">.</span><span class="n">report</span></a><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_10-TroubleShooting_003.png" srcset="../_images/sphx_glr_plot_10-TroubleShooting_003.png" alt="plot 10 TroubleShooting" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>==================================================================================================

                                       POWER SPECTRUM MODEL

                       The model was fit with the &#39;spectral fit&#39; algorithm
               Model was fit to the 1-50 Hz frequency range with 0.50 Hz resolution

                               Aperiodic Parameters (&#39;fixed&#39; mode)
                                        (offset, exponent)
                                         19.9965, 1.9965

                         Peak Parameters (&#39;gaussian&#39; mode) 3 peaks found
                                CF:  10.00, PW:   0.99, BW:   1.94
                                CF:  19.95, PW:   0.31, BW:   2.78
                                CF:  32.04, PW:   0.23, BW:   1.97

                                    Model fit quality metrics:
                                     error (mae) is 0.0182
                                  gof (rsquared) is 0.9992

==================================================================================================
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check reconstructed parameters compared to the simulated parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ground Truth </span><span class="se">\t\t</span><span class="s1"> Model Parameters&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sy</span><span class="p">,</span> <span class="n">fi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gauss_params</span><span class="p">),</span> <a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fm</span></a><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">periodic</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1"> </span><span class="si">{:5.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">sy</span><span class="p">,</span> <span class="o">*</span><span class="n">fi</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Ground Truth             Model Parameters
10.00  1.00  1.00        10.00  0.99  0.97
20.00  0.30  1.50        19.95  0.31  1.39
32.00  0.25  1.00        32.04  0.23  0.98
</pre></div>
</div>
</section>
<section id="checking-fits-across-a-group">
<h2>Checking Fits Across a Group<a class="headerlink" href="#checking-fits-across-a-group" title="Permalink to this heading">¶</a></h2>
<p>So far we have explored troubleshooting individual model fits. When starting
a new analysis, or working with a new dataset, we do recommend starting by
trying some individual fits like this.</p>
<p>If and when you move to using <a class="reference internal" href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel" title="specparam.SpectralGroupModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpectralGroupModel</span></code></a> to fit groups of
power spectra, there are some slightly different ways to investigate groups of fits,
which we’ll step through now, using some simulated data.</p>
<section id="simulating-a-group-of-power-spectra">
<h3>Simulating a Group of Power Spectra<a class="headerlink" href="#simulating-a-group-of-power-spectra" title="Permalink to this heading">¶</a></h3>
<p>We will continue using simulated data, this time simulating a group of power spectra.</p>
<p>To simulate a group of power spectra, we will use the <a class="reference internal" href="../generated/specparam.sim.sim_group_power_spectra.html#specparam.sim.sim_group_power_spectra" title="specparam.sim.sim_group_power_spectra"><code class="xref py py-func docutils literal notranslate"><span class="pre">sim_group_power_spectra()</span></code></a>
in combination with called <a class="reference internal" href="../generated/specparam.sim.params.param_sampler.html#specparam.sim.params.param_sampler" title="specparam.sim.params.param_sampler"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_sampler()</span></code></a> that is used to sample across
possible parameters.</p>
<p>For more and descriptions and example of how the simulations work, check out the
<a class="reference external" href="https://specparam-tools.github.io/auto_examples/index.html">examples</a> section.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulation settings for a group of power spectra</span>
<span class="n">n_spectra</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">sim_freq_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
<span class="n">nlv</span> <span class="o">=</span> <span class="mf">0.010</span>

<span class="c1"># Set the parameter options for aperiodic component and peaks</span>
<span class="n">ap_opts</span> <span class="o">=</span> <a href="../generated/specparam.sim.params.param_sampler.html#specparam.sim.params.param_sampler" title="specparam.sim.params.param_sampler" class="sphx-glr-backref-module-specparam-sim-params sphx-glr-backref-type-py-function"><span class="n">param_sampler</span></a><span class="p">([[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">35</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]])</span>
<span class="n">gauss_opts</span> <span class="o">=</span> <a href="../generated/specparam.sim.params.param_sampler.html#specparam.sim.params.param_sampler" title="specparam.sim.params.param_sampler" class="sphx-glr-backref-module-specparam-sim-params sphx-glr-backref-type-py-function"><span class="n">param_sampler</span></a><span class="p">([[],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>

<span class="c1"># Simulate a group of power spectra</span>
<span class="n">freqs</span><span class="p">,</span> <span class="n">power_spectra</span> <span class="o">=</span> <a href="../generated/specparam.sim.sim_group_power_spectra.html#specparam.sim.sim_group_power_spectra" title="specparam.sim.sim_group_power_spectra" class="sphx-glr-backref-module-specparam-sim sphx-glr-backref-type-py-function"><span class="n">sim_group_power_spectra</span></a><span class="p">(</span>\
    <span class="n">n_spectra</span><span class="p">,</span> <span class="n">sim_freq_range</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;fixed&#39;</span> <span class="p">:</span> <span class="n">ap_opts</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;gaussian&#39;</span> <span class="p">:</span> <span class="n">gauss_opts</span><span class="p">},</span> <span class="n">nlv</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize a group model object</span>
<a href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel" title="specparam.SpectralGroupModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fg</span></a> <span class="o">=</span> <a href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel" title="specparam.SpectralGroupModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class"><span class="n">SpectralGroupModel</span></a><span class="p">(</span><span class="n">peak_width_limits</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit power spectrum models and report on the group</span>
<a href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel.report" title="specparam.SpectralGroupModel.report" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fg</span><span class="o">.</span><span class="n">report</span></a><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">power_spectra</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_10-TroubleShooting_004.png" srcset="../_images/sphx_glr_plot_10-TroubleShooting_004.png" alt="Aperiodic Fit, Fit Quality, Peaks - Center Frequencies" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Fitting model across 10 power spectra.
==================================================================================================

                            GROUP SPECTRAL MODEL RESULTS (10 spectra)

                       The model was fit with the &#39;spectral fit&#39; algorithm
               Model was fit to the 3-50 Hz frequency range with 0.50 Hz resolution

                               Aperiodic Parameters (&#39;fixed&#39; mode)
                         offset   - Min:  20.00, Max:  50.07, Mean: 39.52
                         exponent - Min:   1.50, Max:   2.54, Mean:  2.11

                      Peak Parameters (&#39;gaussian&#39; mode) 49 total peaks found

                                    Model fit quality metrics:
                          error (mae) -  Min:  0.006, Max:  0.012, Mean: 0.009
                       gof (rsquared) -  Min:  1.000, Max:  1.000, Mean: 1.000

==================================================================================================
</pre></div>
</div>
<p>In the <a class="reference internal" href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel" title="specparam.SpectralGroupModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpectralGroupModel</span></code></a> report we can get a sense of the overall
performance by looking at the information about the goodness of fit metrics, and also things
like the distribution of peaks.</p>
<p>However, while these metrics can help identify if fits are, on average, going well (or not)
they don’t necessarily indicate the source of any problems.</p>
<p>To do so, we will typically still want to visualize some example fits, to see
what is happening. To do so, next we will find which fits have the most error,
and select these fits from the <a class="reference internal" href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel" title="specparam.SpectralGroupModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpectralGroupModel</span></code></a> object to visualize.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the index of the worst model fit from the group</span>
<span class="n">worst_fit_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><a href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel.get_metrics" title="specparam.SpectralGroupModel.get_metrics" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fg</span><span class="o">.</span><span class="n">get_metrics</span></a><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">))</span>

<span class="c1"># Extract this model fit from the group</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fm</span></a> <span class="o">=</span> <a href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel.get_model" title="specparam.SpectralGroupModel.get_model" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fg</span><span class="o">.</span><span class="n">get_model</span></a><span class="p">(</span><span class="n">worst_fit_ind</span><span class="p">,</span> <span class="n">regenerate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check results and visualize the extracted model</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel.print_results" title="specparam.SpectralModel.print_results" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fm</span><span class="o">.</span><span class="n">print_results</span></a><span class="p">()</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel.plot" title="specparam.SpectralModel.plot" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fm</span><span class="o">.</span><span class="n">plot</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_10-TroubleShooting_005.png" srcset="../_images/sphx_glr_plot_10-TroubleShooting_005.png" alt="plot 10 TroubleShooting" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>==================================================================================================

                                       POWER SPECTRUM MODEL

                       The model was fit with the &#39;spectral fit&#39; algorithm
               Model was fit to the 3-50 Hz frequency range with 0.50 Hz resolution

                               Aperiodic Parameters (&#39;fixed&#39; mode)
                                        (offset, exponent)
                                         50.0719, 2.5409

                         Peak Parameters (&#39;gaussian&#39; mode) 6 peaks found
                                CF:   9.90, PW:   0.47, BW:   3.38
                                CF:  13.18, PW:   0.18, BW:   3.56
                                CF:  16.98, PW:   0.20, BW:   2.90
                                CF:  19.84, PW:   0.27, BW:   3.91
                                CF:  23.27, PW:   0.18, BW:   3.88
                                CF:  27.05, PW:   0.05, BW:   1.73

                                    Model fit quality metrics:
                                     error (mae) is 0.0122
                                  gof (rsquared) is 0.9996

==================================================================================================
</pre></div>
</div>
<p>You can also loop through all the results in a <a class="reference internal" href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel" title="specparam.SpectralGroupModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpectralGroupModel</span></code></a>,
extracting all fits that meet some criterion that makes them worth checking.</p>
<p>This might be checking for fits above some error threshold, as below, but note
that you may also want to do a similar procedure to examine fits with the lowest
error, to check if the model may be overfitting, or perhaps fits with a particularly
large number of gaussians.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract all fits that are above some error threshold, for further examination.</span>
<span class="c1">#  You could also do a similar analysis for particularly low errors</span>
<span class="n">error_threshold</span> <span class="o">=</span> <span class="mf">0.010</span>
<span class="n">to_check</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <a href="../generated/specparam.data.FitResults.html#specparam.data.FitResults" title="specparam.data.FitResults" class="sphx-glr-backref-module-specparam-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">res</span></a> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><a href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel" title="specparam.SpectralGroupModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fg</span></a><span class="o">.</span><span class="n">results</span><span class="p">):</span>
    <span class="k">if</span> <a href="../generated/specparam.data.FitResults.html#specparam.data.FitResults" title="specparam.data.FitResults" class="sphx-glr-backref-module-specparam-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">res</span></a><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;error_mae&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">error_threshold</span><span class="p">:</span>
        <span class="n">to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel.get_model" title="specparam.SpectralGroupModel.get_model" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fg</span><span class="o">.</span><span class="n">get_model</span></a><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">regenerate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># A more condensed version of the procedure above can be written like this:</span>
<span class="c1">#to_check = [fg.get_model(ind, True) for ind, res in enumerate(fg) \</span>
<span class="c1">#                if res.metrics[&#39;error_mae&#39;] &gt; error_threshold]</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop through the problem fits, checking the plots, and saving out reports, to check later.</span>
<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel" title="specparam.SpectralModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fm</span></a> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">to_check</span><span class="p">):</span>
    <a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel.plot" title="specparam.SpectralModel.plot" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fm</span><span class="o">.</span><span class="n">plot</span></a><span class="p">()</span>
    <a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel.save_report" title="specparam.SpectralModel.save_report" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-method"><span class="n">fm</span><span class="o">.</span><span class="n">save_report</span></a><span class="p">(</span><span class="s1">&#39;report_to_check_#&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../_images/sphx_glr_plot_10-TroubleShooting_006.png" srcset="../_images/sphx_glr_plot_10-TroubleShooting_006.png" alt="plot 10 TroubleShooting" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_plot_10-TroubleShooting_007.png" srcset="../_images/sphx_glr_plot_10-TroubleShooting_007.png" alt="plot 10 TroubleShooting" class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/Users/tom/opt/anaconda3/lib/python3.8/site-packages/specparam/reports/save.py:63: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.savefig(create_file_path(file_name, file_path, SAVE_FORMAT))
/Users/tom/opt/anaconda3/lib/python3.8/site-packages/specparam/reports/save.py:63: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.savefig(create_file_path(file_name, file_path, SAVE_FORMAT))
/Users/tom/opt/anaconda3/lib/python3.8/site-packages/specparam/reports/save.py:63: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.savefig(create_file_path(file_name, file_path, SAVE_FORMAT))
</pre></div>
</div>
<p>Another thing that can be worth keeping an eye on is the average number of fit
peaks per model. A particularly high value can indicate overfitting.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the average number of fit peaks, per model</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average number of fit peaks: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><a href="../generated/specparam.SpectralGroupModel.html#specparam.SpectralGroupModel" title="specparam.SpectralGroupModel" class="sphx-glr-backref-module-specparam sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fg</span></a><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">n_peaks</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Average number of fit peaks:  4.9
</pre></div>
</div>
</section>
</section>
<section id="reporting-bad-fits">
<h2>Reporting Bad Fits<a class="headerlink" href="#reporting-bad-fits" title="Permalink to this heading">¶</a></h2>
<p>If, after working through these suggestions, you are still getting bad fits, and/or
are just not sure what is going on, please get in touch! We will hopefully be able to
make further recommendations, and this also serves as a way for us to investigate when
and why model fitting fails, so that we can continue to make it better.</p>
<p>You can report issues on Github <cite>here &lt;https://github.com/fooof-tools/fooof&gt;</cite>.</p>
<p>There is also a helper method to print out instructions for reporting
bad fits / bugs back to us, as demonstrated below.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print out instructions to report bad fits</span>
<a href="../generated/specparam.SpectralModel.html#specparam.SpectralModel.print_report_issue" title="specparam.SpectralModel.print_report_issue" class="sphx-glr-backref-module-specparam-SpectralModel sphx-glr-backref-type-py-method"><span class="n">SpectralModel</span><span class="o">.</span><span class="n">print_report_issue</span></a><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>==================================================================================================

                                   specparam - ISSUE REPORTING

                      Please report any bugs or unexpected errors on Github:
                           https://github.com/fooof-tools/fooof/issues

               If model fitting gives you any weird / bad fits, please let us know!
              To do so, you can send us a fit report, and an associated data file,

             With a model object (model), after fitting, run the following commands:
                              model.create_report(&#39;bad_fit_report&#39;)
                           model.save(&#39;bad_fit_data&#39;, True, True, True)

                      You can attach the generated files to a Github issue.

==================================================================================================
</pre></div>
</div>
<p>Note that you can also call this method from SpectralGroupModel
(ex: <cite>SpectralGroupModel.print_report_issue()</cite>) as well as from instances of these objects
(ex: <cite>fm.print_report_issue()</cite>, <cite>fg.print_report_issue()</cite>)</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h2>
<p>We have now stepped through the full work-flow of fitting power spectrum models, using
model objects, picking settings, and troubleshooting model fits. In the next
and final tutorial, we will introduce how to start analyzing model results.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 2.063 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-plot-10-troubleshooting-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b932ccf6b4f0d2d5d9fd9cc4412c53a7/plot_10-TroubleShooting.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_10-TroubleShooting.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/87cdf5f33b90cb37ad6729d003459a01/plot_10-TroubleShooting.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_10-TroubleShooting.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018-2025, VoytekLab.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>